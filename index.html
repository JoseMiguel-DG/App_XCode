<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0c66ea" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Engine-Mode Tracker" />

    <title>Engine-Mode Tracker</title>

    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="assets/icons/favicon-16.png" sizes="16x16" />
    <link rel="icon" href="assets/icons/favicon-32.png" sizes="32x32" />
    <link rel="icon" href="assets/icons/icon-192.png" sizes="192x192" />
    <link rel="icon" href="assets/icons/icon-512.png" sizes="512x512" />
    <link rel="apple-touch-icon" href="assets/icons/apple-touch-icon.png" />

    <!-- iOS splash screens -->
    <link
      rel="apple-touch-startup-image"
      href="assets/splash/splash-640x1136.png"
      media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)"
    />
    <link
      rel="apple-touch-startup-image"
      href="assets/splash/splash-750x1334.png"
      media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)"
    />
    <link
      rel="apple-touch-startup-image"
      href="assets/splash/splash-828x1792.png"
      media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)"
    />
    <link
      rel="apple-touch-startup-image"
      href="assets/splash/splash-1125x2436.png"
      media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)"
    />
    <link
      rel="apple-touch-startup-image"
      href="assets/splash/splash-1170x2532.png"
      media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)"
    />
    <link
      rel="apple-touch-startup-image"
      href="assets/splash/splash-1242x2688.png"
      media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)"
    />
    <link
      rel="apple-touch-startup-image"
      href="assets/splash/splash-1536x2048.png"
      media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)"
    />
    <link
      rel="apple-touch-startup-image"
      href="assets/splash/splash-1668x2224.png"
      media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2)"
    />
    <link
      rel="apple-touch-startup-image"
      href="assets/splash/splash-1668x2388.png"
      media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)"
    />
    <link
      rel="apple-touch-startup-image"
      href="assets/splash/splash-2048x2732.png"
      media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)"
    />

    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="app">
      <div class="update-toast" id="updateToast" hidden>
        <p class="update-toast__text">Nueva version disponible.</p>
        <button class="button button--primary" id="updateNow">Actualizar</button>
      </div>
      <header class="app__header">
        <div class="brand">
          <img class="brand__logo" src="assets/brand-mark.png" alt="Engine-Mode Tracker" />
          <div>
            <p class="app__subtitle">Engine-Mode Tracker</p>
            <h1 class="app__title">Entrena con datos reales</h1>
          </div>
        </div>
        <span class="status" id="statusBadge">Offline</span>
      </header>

      <nav class="app__nav">
        <button class="nav__button" data-route="home">Inicio</button>
        <button class="nav__button" data-route="train">Entrenar</button>
        <button class="nav__button" data-route="routines">Rutinas</button>
        <button class="nav__button" data-route="history">Historial</button>
        <button class="nav__button" data-route="exercises">Biblioteca</button>
        <button class="nav__button" data-route="settings">Ajustes</button>
      </nav>

      <main class="app__content">
        <section class="panel" data-view="auth" hidden>
          <div class="panel__header">
            <div>
              <h2>Iniciar sesion</h2>
              <p class="panel__subtitle">Accede para usar tu biblioteca en la nube.</p>
            </div>
          </div>
          <div class="card">
            <div class="form__grid" id="cloudAuthForm">
              <div class="form__field">
                <label class="form__label" for="cloudEmail">Email</label>
                <input
                  class="form__input"
                  id="cloudEmail"
                  type="email"
                  autocomplete="email"
                  placeholder="tu@email.com"
                />
              </div>
              <div class="form__field">
                <label class="form__label" for="cloudPassword">Contrasena</label>
                <input
                  class="form__input"
                  id="cloudPassword"
                  type="password"
                  autocomplete="current-password"
                  placeholder="********"
                />
              </div>
              <p class="form__error" id="cloudError"></p>
              <div class="status-row">
                <span class="status-dot" id="cloudStatusDotUnauthed"></span>
                <p class="card__text" id="cloudStatusUnauthed">No autenticado.</p>
              </div>
              <div class="form__actions">
                <button class="button button--primary" id="cloudLogin">Entrar</button>
                <button class="button button--ghost" id="cloudSignup">Crear cuenta</button>
              </div>
            </div>
          </div>
        </section>

        <section class="panel" data-view="home" hidden>
          <div class="panel__header">
            <div>
              <h2>Inicio</h2>
              <p class="panel__subtitle">Resumen de rendimiento y proxima sesion.</p>
            </div>
          </div>

          <div class="card hero-card">
            <div>
              <p class="hero-card__eyebrow">Panel de rendimiento</p>
              <h3 class="hero-card__title">Controla el progreso con sesiones reales.</h3>
              <p class="card__text">
                Visualiza volumen, PRs y constancia sin perder el foco. Todo se sincroniza con tu cuenta.
              </p>
              <div class="hero-card__actions">
                <button class="button button--primary" id="homeGoTrain">Empezar sesion</button>
                <button class="button button--ghost" data-route="routines">Ver rutinas</button>
              </div>
            </div>
            <img class="hero-card__image" src="assets/hero-workout.svg" alt="Entrenamiento" />
          </div>

          <div class="metric-grid">
            <div class="card metric-card" id="homeConsistencyCard" hidden>
              <p class="metric-card__label">Sesiones en 7 dias</p>
              <p class="metric-card__value" id="homeConsistencyValue"></p>
              <div class="progress">
                <span class="progress__bar" id="homeConsistencyBar"></span>
              </div>
            </div>
            <div class="card metric-card" id="homeVolumeCard" hidden>
              <p class="metric-card__label">Volumen semanal</p>
              <p class="metric-card__value" id="homeVolumeValue"></p>
              <p class="metric-card__delta" id="homeVolumeDelta"></p>
            </div>
            <div class="card metric-card" id="homePrsCard" hidden>
              <p class="metric-card__label">PRs recientes</p>
              <p class="metric-card__value" id="homePrsValue"></p>
              <p class="metric-card__delta" id="homePrsDelta"></p>
            </div>
          </div>

          <div class="card chart-card" id="homeChartCard" hidden>
            <div class="card__row">
              <div>
                <p class="card__title">Rendimiento 14 dias</p>
                <p class="card__text">Carga total por sesion.</p>
              </div>
              <span class="pill">Tendencia</span>
            </div>
            <div class="sparkline">
              <svg viewBox="0 0 240 80" aria-hidden="true" focusable="false">
                <polyline
                  id="homeSparkline"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="3"
                  points=""
                />
              </svg>
            </div>
          </div>

          <div class="card" id="homeNextSessionCard" hidden>
            <p class="card__title">Proxima sesion</p>
            <p class="card__text" id="homeNextSessionTitle"></p>
            <div class="card__row">
              <div class="mini-list" id="homeNextSessionList"></div>
              <button class="button button--primary" id="homeGoTrain">Ir a Entrenar</button>
            </div>
          </div>

        </section>

        <section class="panel" data-view="train">
          <div class="panel__header">
            <div>
              <h2>Entrenar</h2>
              <p class="panel__subtitle">Selecciona un dia y revisa la rutina.</p>
            </div>
          </div>

          <div class="card">
            <label class="form__label" for="routineDaySelect">Dia</label>
            <select class="form__input" id="routineDaySelect"></select>
            <p class="form__error" id="routineDaySelectError"></p>
          </div>

          <div class="card" id="routineDayPreview">
            <p class="card__title" id="routineDayName">Sin rutina</p>
            <p class="card__text" id="routineDayNotes"></p>
            <ul class="list list--compact" id="routineDayItems"></ul>
          </div>

          <div class="panel__actions" id="trainingActionButtons">
            <button class="button button--primary" id="startSessionButton">Iniciar sesion</button>
            <button class="button button--ghost" id="resumeSessionButton" hidden>Reanudar sesion</button>
            <button class="button button--danger" id="finishSessionFromHome" hidden>
              Finalizar sesion
            </button>
          </div>
        </section>

        <section class="panel" data-view="history" hidden>
          <div class="panel__header">
            <div>
              <h2>Historial</h2>
              <p class="panel__subtitle">Sesiones pasadas y registros guardados.</p>
            </div>
          </div>

          <div class="card" id="historyDetail" hidden>
            <div class="panel__header panel__header--tight">
              <div>
                <button class="button button--ghost" id="historyBack">Volver</button>
                <h3 id="historyDetailTitle">Sesion</h3>
                <p class="panel__subtitle" id="historyDetailMeta"></p>
              </div>
              <button class="button button--danger" id="historyDelete">Eliminar</button>
            </div>
            <div class="stack" id="historyDetailList"></div>
          </div>

          <ul class="list" id="historyList"></ul>
        </section>

        <section class="panel" data-view="routines" hidden>
          <div class="panel__header">
            <div>
              <h2>Rutinas</h2>
              <p class="panel__subtitle">Crea plantillas por dia.</p>
            </div>
            <button class="button button--primary" id="newRoutineDayButton">+ Nuevo dia</button>
          </div>

          <form class="form" id="routineDayForm" hidden>
            <h4 class="form__title">Nuevo dia</h4>
            <div class="form__grid">
              <div class="form__field">
                <label class="form__label" for="routineDayNameInput">Nombre*</label>
                <input
                  class="form__input"
                  id="routineDayNameInput"
                  type="text"
                  placeholder="Ej. Pecho, Push A"
                  maxlength="40"
                  required
                />
              </div>
              <div class="form__field">
                <label class="form__label" for="routineDayNotesInput">Notas</label>
                <textarea
                  class="form__input form__input--textarea"
                  id="routineDayNotesInput"
                  rows="2"
                  placeholder="Opcional"
                ></textarea>
              </div>
            </div>
            <p class="form__error" id="routineDayError"></p>
            <div class="form__actions">
              <button class="button button--primary" type="submit">Guardar</button>
              <button class="button button--ghost" type="button" id="cancelRoutineDay">Cancelar</button>
            </div>
          </form>

          <ul class="list" id="routineDayList"></ul>

          <div class="card" id="routineEditor" hidden>
            <div class="panel__header panel__header--tight">
              <div>
                <h3 id="routineEditorTitle">Editar dia</h3>
                <p class="panel__subtitle" id="routineEditorMeta"></p>
              </div>
              <div class="panel__actions">
                <button
                  class="icon-button icon-button--toggle"
                  id="toggleRoutineEditFields"
                  title="Mostrar edicion"
                  aria-label="Mostrar edicion"
                >
                  <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path
                      d="M6 9l6 6 6-6"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </button>
                <button class="icon-button" id="duplicateRoutineDay" title="Duplicar" aria-label="Duplicar">
                  <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path
                      d="M7 7h10v12H7z"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M5 5h10v2H5z"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </button>
                <button
                  class="icon-button icon-button--danger"
                  id="deleteRoutineDay"
                  title="Eliminar"
                  aria-label="Eliminar"
                >
                  <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path
                      d="M3 6h18"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M8 6V4h8v2"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M6 6l1 14h10l1-14"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </button>
              </div>
            </div>

            <div class="form__grid" id="routineEditFields" hidden>
              <div class="form__field">
                <label class="form__label" for="routineDayEditName">Nombre*</label>
                <input
                  class="form__input"
                  id="routineDayEditName"
                  type="text"
                  maxlength="40"
                  required
                />
              </div>
              <div class="form__field">
                <label class="form__label" for="routineDayEditNotes">Notas</label>
                <textarea
                  class="form__input form__input--textarea"
                  id="routineDayEditNotes"
                  rows="2"
                  placeholder="Opcional"
                ></textarea>
              </div>
              <p class="form__error" id="routineEditorError"></p>
              <div class="form__actions">
                <button class="button button--primary" id="saveRoutineDayEdits">Guardar cambios</button>
              </div>
            </div>

            <div class="panel__header panel__header--tight">
              <h3>Ejercicios</h3>
            </div>
            <ul class="list" id="routineItemList"></ul>

            <div class="form__grid">
              <div class="form__field">
                <label class="form__label" for="routineExerciseSearch">Buscar ejercicio</label>
                <input
                  class="form__input"
                  id="routineExerciseSearch"
                  type="search"
                  placeholder="Nombre..."
                />
              </div>
              <div class="form__field">
                <label class="form__label" for="routineCategoryFilter">Categoria</label>
                <select class="form__input" id="routineCategoryFilter"></select>
              </div>
              <div class="form__field">
                <label class="form__label" for="routineExerciseSelect">Ejercicio</label>
                <select class="form__input" id="routineExerciseSelect"></select>
              </div>
              <div class="form__actions">
                <button class="button button--primary" id="addRoutineItem">+ Agregar ejercicio</button>
              </div>
            </div>
          </div>
        </section>

        <section class="panel" data-view="exercises" hidden>
          <div class="panel__header">
            <div>
              <h2>Ejercicios</h2>
              <p class="panel__subtitle">
                Gestiona tus categorías y ejercicios guardados localmente.
              </p>
            </div>
            <button class="button button--primary" id="newCategoryButton">+ Nueva categoría</button>
          </div>

          <form class="form" id="categoryForm" hidden>
            <div class="form__row">
              <div class="form__field">
                <label class="form__label" for="categoryName">Nombre de la categoría</label>
                <input
                  class="form__input"
                  id="categoryName"
                  type="text"
                  placeholder="Ej. Pecho"
                  maxlength="40"
                  required
                />
                <p class="form__error" id="categoryError"></p>
              </div>
              <div class="form__actions">
                <button class="button button--primary" type="submit">Guardar</button>
                <button class="button button--ghost" type="button" id="cancelCategory">Cancelar</button>
              </div>
            </div>
          </form>

          <ul class="list" id="categoryList"></ul>
        </section>

        <section class="panel" data-view="category" hidden>
          <div class="panel__header">
            <div>
              <button class="button button--ghost" id="backToCategories">← Volver</button>
              <h2 id="categoryTitle">Categoría</h2>
              <p class="panel__subtitle" id="categoryMeta"></p>
            </div>
            <div class="panel__actions">
              <button class="button button--ghost" id="renameCategory">Renombrar</button>
              <button class="button button--danger" id="deleteCategory">Eliminar</button>
            </div>
          </div>
          <p class="form__error" id="categoryDetailError"></p>

          <div class="search">
            <input
              class="form__input"
              id="exerciseSearch"
              type="search"
              placeholder="Buscar ejercicio..."
            />
          </div>

          <div class="panel__header panel__header--tight">
            <h3>Ejercicios</h3>
            <button class="button button--primary" id="newExerciseButton">+ Nuevo ejercicio</button>
          </div>

          <form class="form" id="exerciseForm" hidden>
            <h4 class="form__title" id="exerciseFormTitle">Nuevo ejercicio</h4>
            <input type="hidden" id="exerciseId" />
            <div class="form__grid">
              <div class="form__field">
                <label class="form__label" for="exerciseName">Nombre*</label>
                <input
                  class="form__input"
                  id="exerciseName"
                  type="text"
                  placeholder="Ej. Press banca con barra"
                  maxlength="60"
                  required
                />
              </div>
              <div class="form__field">
                <label class="form__label" for="exerciseDescription">Descripción</label>
                <textarea
                  class="form__input form__input--textarea"
                  id="exerciseDescription"
                  rows="2"
                  placeholder="Opcional"
                ></textarea>
              </div>
              <div class="form__field">
                <label class="form__label" for="exercisePrimaryMuscle">Grupo muscular principal</label>
                <input
                  class="form__input"
                  id="exercisePrimaryMuscle"
                  type="text"
                  placeholder="Ej. Pecho"
                />
              </div>
              <div class="form__field">
                <label class="form__label" for="exerciseEquipment">Equipamiento</label>
                <input
                  class="form__input"
                  id="exerciseEquipment"
                  type="text"
                  placeholder="Ej. Barra"
                />
              </div>
              <div class="form__field">
                <label class="form__label" for="exerciseTags">Tags (separados por coma)</label>
                <input
                  class="form__input"
                  id="exerciseTags"
                  type="text"
                  placeholder="Ej. fuerza, básico"
                />
              </div>
              <div class="form__field">
                <label class="form__label" for="exerciseCategorySelect">Categoría</label>
                <select class="form__input" id="exerciseCategorySelect"></select>
              </div>
            </div>
            <p class="form__error" id="exerciseError"></p>
            <div class="form__actions">
              <button class="button button--primary" type="submit" id="saveExerciseButton">
                Guardar ejercicio
              </button>
              <button class="button button--ghost" type="button" id="cancelExercise">
                Cancelar
              </button>
            </div>
          </form>

          <ul class="list" id="exerciseList"></ul>
        </section>

        <section class="panel" data-view="settings" hidden>
          <h2>Ajustes</h2>
          <div class="card">
            <p class="card__title">Tema</p>
            <p class="card__text">Cambia el aspecto sin salir de la app.</p>
            <button class="button button--primary" id="themeToggle">Alternar modo</button>
          </div>
          <div class="card">
            <p class="card__title">Datos locales</p>
            <p class="card__text">La biblioteca se guarda solo en este dispositivo.</p>
            <button class="button button--danger" id="resetLibrary">Borrar biblioteca</button>
          </div>
          <div class="card">
            <p class="card__title">Exportar / Importar</p>
            <p class="card__text">Guarda o restaura toda la base local en JSON.</p>
            <div class="form__actions">
              <button class="button button--primary" id="exportData">Exportar datos</button>
              <button class="button button--ghost" id="importData">Importar datos</button>
              <input type="file" id="importFile" accept="application/json" hidden />
            </div>
          </div>
          <p class="app__version">Version <span id="appVersion"></span></p>
          <div class="card">
            <p class="card__title">Sincronizacion</p>
            <p class="card__text">Estado de tu cuenta y datos en la nube.</p>
            <div class="sync-card">
              <div class="sync-session" id="cloudSessionPanel" hidden>
                <div class="sync-session__header">
                  <div class="sync-session__icon">✓</div>
                  <div>
                    <p class="sync-session__title">Sesion activa</p>
                    <p class="sync-session__email" id="cloudSessionEmail"></p>
                  </div>
                </div>
                <div class="status-row">
                  <span class="status-dot" id="cloudStatusDot"></span>
                  <p class="card__text" id="cloudStatus">No autenticado.</p>
                </div>
                <p class="card__text" id="cloudLastSync"></p>
                <div class="form__actions">
                  <button class="button button--danger" id="cloudLogout" hidden>Salir</button>
                </div>
              </div>

              <div class="form__actions sync-actions">
                <button class="button button--primary" id="cloudUpload" hidden>Subir datos</button>
                <button class="button button--ghost" id="cloudDownload" hidden>Descargar datos</button>
              </div>
            </div>
          </div>
        </section>

        <section class="panel" data-view="workout" hidden>
          <div class="panel__header">
            <div>
              <button class="button button--ghost" id="backToTrain">Volver</button>
              <h2 id="workoutTitle">Sesion activa</h2>
              <p class="panel__subtitle" id="workoutMeta"></p>
            </div>
            <div class="panel__actions">
              <button class="button button--danger" id="finishSessionButton">Finalizar sesion</button>
              <button class="button button--ghost" id="cancelSessionButton">Cancelar</button>
            </div>
          </div>
          <p class="form__error" id="workoutError"></p>
          <div class="stack" id="workoutExerciseList"></div>
        </section>
      </main>
    </div>

    <div class="modal" id="confirmModal" hidden>
      <div class="modal__overlay" data-action="cancel"></div>
      <div
        class="modal__dialog"
        role="dialog"
        aria-modal="true"
        aria-labelledby="confirmTitle"
        aria-describedby="confirmMessage"
      >
        <h3 class="modal__title" id="confirmTitle">Confirmar</h3>
        <p class="modal__message" id="confirmMessage"></p>
        <div class="modal__actions">
          <button class="button button--ghost" id="confirmCancel">Cancelar</button>
          <button class="button button--primary" id="confirmOk">Confirmar</button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="app.js"></script>
  </body>
</html>
